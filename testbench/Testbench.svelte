<script>
  import {
    Suite,
    Describe,
    Test,
    Given,
    Should,
    Show,
    waitOk,
    giveOk,
    snapshot,
    log,
    snapshotMatch,
    snapshotOnTrigger,
    snapshotTrigger,
    action,
    dataURL,
    copy,
  } from '../src';
  import Reveal from './Reveal.svelte';

  const template = (imgs) =>
    imgs.map((src, i) => `<img alt="expected-${i}" src="${src}" />`).join('\n');
</script>

<Test assert={snapshotMatch()}>
  <Given actual="a revealed content" prepare={[waitOk(), 'li', snapshot()]}>
    <Reveal each="li" after={1} on:reveal={giveOk()}>
      <ul>
        <li>A</li>
        <li>B</li>
        <li>C</li>
      </ul>
    </Reveal>
  </Given>
  <Should expect="is properly revealed" prepare="ul > li">
    <ul>
      <li>A</li>
      <li>B</li>
      <li>C</li>
    </ul>
  </Should>
  <div slot="fail" let:error>
    {error.message}
    <Show element={error.diff} />
  </div>
</Test>

<Test assert={snapshotMatch()}>
  <Given
    actual="a revealed content"
    prepare={[
      snapshotOnTrigger(),
      waitOk(),
      action('copy', [dataURL(), log(), copy(template)]),
    ]}
  >
    <Reveal
      each="li"
      after={1}
      on:almost={snapshotTrigger()}
      on:reveal={giveOk()}
    >
      <ul>
        <li>A</li>
        <li>B</li>
        <li>D</li>
      </ul>
    </Reveal>
  </Given>
  <Should expect="is properly revealed">
    <img
      alt="expected-0"
      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABigAAAAkCAYAAAATibJVAAAIPklEQVR4Xu3dTUhUaxgH8McIkqBoU4uiFrZwVdGiRSJRkIURFbUqwoVgRYULN5GQUFAIfYkDbSJByCDpA/qEoAIzaBEJtokKWkVtmhaCUDB5OQcabrd7b6YdmcP83pUzvu/zHH7P7P6cc2omJiYmwiJAgAABAgQIECBAgAABAgQIECBAgAABAgQIzKBAjYBiBrW1IkCAAAECBAgQIECAAAECBAgQIECAAAECBFIBAYUfAgECBAgQIECAAAECBAgQIECAAAECBAgQIDDjAgKKGSfXkAABAgQIECBAgAABAgQIECBAgAABAgQIEBBQ+A0QIECAAAECBAgQIECAAAECBAgQIECAAAECMy4goJhxcg0JECBAgAABAgQIECBAgAABAgQIECBAgAABAYXfAAECBAgQIECAAAECBAgQIECAAAECBAgQIDDjAgKKjMnfvn0bBw8ejGKxmHbq6+uLlStXZtxVeQIECBAgQIAAAQIECBAgQIAAAQIECBAgUNkCAoqM51MoFKK/v7/cZdeuXXH06NGMuypPgAABAgQIECBAgAABAgQIECBAgAABAgQqW0BAkeF8SqVSNDc3l++e+N5qeHg4amtrM+ysNAECBAgQIECAAAECBAgQIECAAAECBAgQqGwBAUWG83n27FkcPnz4pw7d3d2xcePGDDsrTYAAAQIECBAgQIAAAQIECBAgQIAAAQIEKltAQJHhfLq6uuLevXtphyVLlsT79+/TvxsbG6OnpyfDzkoTIECAAAECBAgQIECAAAECBAgQIECAAIHKFhBQZDSfsbGx2LBhQ7n69evXI3n/xPd1//79WLhwYUbdlSVAgAABAgQIECBAgAABAgQIECBAgAABApUtIKDIaD63b9+O48ePp9XXrl0bycuyOzs748GDB+l3HR0dsWfPnoy6K0uAAAECBAgQIECAAAECBAgQIECAAAECBCpbQECR0Xza2tpiZGQkrX7ixInYsmVLDA0NpcFEsurq6mJwcDCj7soSIECAAAECBAgQIECAAAECBAgQIECAAIHKFhBQZDCf5F0T27dvL1d+/PhxzJs3L75+/Zq+HHt8fDz938DAQNTX12dwBUoSIECAAAECBAgQIECAAAECBAgQIECAAIHKFhBQZDCfvr6+uHDhQlo5CSS6u7vLXU6dOhU3btxIP7e0tER7e3sGV6AkAQIECBAgQIAAAQIECBAgQIAAAQIECBCobAEBxR+ez8TEROzYsSOSuyiSdebMmVi/fn25y/Pnz+PAgQPp57lz58ajR49i9uzZf/gqlCNAgAABAgQIECBAgAABAgQIECBAgAABApUtULUBxbt37+LJkyfx4cOHWLFiRRoiJIHBdNfo6Gi0traWyzx9+jTmzJlT/lwqlaK5uTmKxWL6XW9vbzQ0NEy3rfMECBAgQIAAAQIECBAgQIAAAQIECBAgQCBXAlUZULx48SL27dv3w6BWrVoVhUJh2iFF8jina9eupbWT91AcO3bspx9ET09PXL58Of1+06ZNkTz2ySJAgAABAgQIECBAgAABAgQIECBAgAABAtUkUJUBxd69e+PVq1c/zbmrqyu2bds25fl/+fIlmpqayi/BPnTo0L/eHfHy5csf3kuRPOZp/vz5U+7rIAECBAgQIECAAAECBAgQIECAAAECBAgQyJtA1QUU4+PjsW7dun+dUxJOJCHFVNfDhw/jyJEjv308ucsiudvCIkCAAAECBAgQIECAAAECBAgQIECAAAEC1SJQdQHFt2/f0vdNJEHFP1fy2Kd/Pvrpd34IHR0dMTQ09DtH0r3J46UuXbr02+ccIECAAAECBAgQIECAAAECBAgQIECAAAECeRWouoAiGdS5c+fiypUrP81sYGAg6uvrpzTLT58+xebNm8tnk9BhzZo1/1nr9evXP4QZN2/ejKVLl06pt0MECBAgQIAAAQIECBAgQIAAAQIECBAgQCBvAlUZUJRKpTh79mzcuXMnvZNi2bJlkdz90NjYOOX5Xb16NU6fPp2eX7RoUdy9ezdqamr+t97u3bvjzZs36Z79+/dHW1vblPs7SIAAAQIECBAgQIAAAQIECBAgQIAAAQIE8iRQlQHF9wElQcXY2FgsWLBg2jP7e9iQBA1J4PCrldyxcf78+XRbEmokgcmsWbN+dcz/CRAgQIAAAQIECBAgQIAAAQIECBAgQIBA7gWqOqD4U9NL7oJIAorvK7mbYvny5b8s//Hjx9i6dWt538WLF2P16tW/PGcDAQIECBAgQIAAAQIECBAgQIAAAQIECBDIu4CA4g9MsFAoRH9/f1qprq4uBgcHJ101udtiZGQk3b9z587o7Oyc9FkbCRAgQIAAAQIECBAgQIAAAQIECBAgQIBAXgUEFNOcXPKYqObm5igWi2ml9vb2aGlpmXTV5OXYJ0+eLO8fHh6O2traSZ+3kQABAgQIECBAgAABAgQIECBAgAABAgQI5FFAQDHNqY2OjkZra2u5yq1bt2Lx4sWTrvr58+doamoq7+/t7Y2GhoZJn7eRAAECBAgQIECAAAECBAgQIECAAAECBAjkUUBAkcepuWYCBAgQIECAAAECBAgQIECAAAECBAgQIJBzAQFFzgfo8gkQIECAAAECBAgQIECAAAECBAgQIECAQB4FBBR5nJprJkCAAAECBAgQIECAAAECBAgQIECAAAECORcQUOR8gC6fAAECBAgQIECAAAECBAgQIECAAAECBAjkUUBAkcepuWYCBAgQIECAAAECBAgQIECAAAECBAgQIJBzAQFFzgfo8gkQIECAAAECBAgQIECAAAECBAgQIECAQB4F/gL9OsqkMiBG0QAAAABJRU5ErkJggg=="
    />
    <img
      alt="expected-1"
      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABigAAABICAYAAABsv310AAAP10lEQVR4Xu3dbWhW9RsH8EsbJgOXBPVi0l4YNitURCIaQ4yymoRGRaENCcEHlkjuRQ+Ci+wBwYdko8IkQ2lGUklmBkEKajHKFPSNZeArM8gWsRglTOMc8MZt/v9u984t99n9+UHYdp/fdf32ue53X845Yy5dunQpLAIECBAgQIAAAQIECBAgQIAAAQIECBAgQIDAdRQYI6C4jtpaESBAgAABAgQIECBAgAABAgQIECBAgAABAqmAgMIXgQABAgQIECBAgAABAgQIECBAgAABAgQIELjuAgKK606uIQECBAgQIECAAAECBAgQIECAAAECBAgQICCg8B0gQIAAAQIECBAgQIAAAQIECBAgQIAAAQIErruAgOK6k2tIgAABAgQIECBAgAABAgQIECBAgAABAgQICCh8BwgQIECAAAECBAgQIECAAAECBAgQIECAAIHrLiCgKDH5L7/8Ei0tLdHd3Z122r59e0yfPr3EXZUnQIAAAQIECBAgQIAAAQIECBAgQIAAAQLlLSCgKPF8Ojo6YseOHYUuTzzxRLz88ssl7qo8AQIECBAgQIAAAQIECBAgQIAAAQIECBAobwEBRQnn09fXF01NTYW7Jy63OnLkSIwfP76EnZUmQIAAAQIECBAgQIAAAQIECBAgQIAAAQLlLSCgKOF8urq6YuXKlYM6rF+/Ph588MESdlaaAAECBAgQIECAAAECBAgQIECAAAECBAiUt4CAooTzaWtri/3796cdJk2aFGfPnk3/v7GxMbZs2VLCzkoTIECAAAECBAgQIECAAAECBAgQIECAAIHyFhBQlGg+PT09cf/99xeqf/rpp5G8f+Ly+uqrr+KWW24pUXdlCRAgQIAAAQIECBAgQIAAAQIECBAgQIBAeQsIKEo0ny+++CJeffXVtPp9990Xycuy16xZE19//XX6u9bW1li0aFGJuitLgAABAgQIECBAgAABAgQIECBAgAABAgTKW0BAUaL5LF26NI4fP55WX7duXcybNy8OHTqUBhPJmjx5cuzevbtE3ZUlQIAAAQIECBAgQIAAAQIECBAgQIAAAQLlLSCgKMF8kndNLFiwoFD54MGDMWHChLhw4UL6cuze3t70s87Ozqivry/BCZQkQIAAAQIECBAgQIAAAQIECBAgQIAAAQLlLSCgKMF8tm/fHu+8805aOQkk1q9fX+jy5ptvxmeffZb+vHjx4li1alUJTqAkAQIECBAgQIAAAQIECBAgQIAAAQIECBAobwEBRcbzuXTpUjz22GOR3EWRrI0bN8acOXMKXY4ePRorVqxIf66uro4DBw5EVVVVxqdQjgABAgQIECBAgAABAgQIECBAgAABAgQIlLdAxQYUZ86cicOHD8e5c+di2rRpaYiQBAYjXSdOnIglS5YUynz77bdx4403Fn7u6+uLpqam6O7uTn/X3t4eDQ0NI21rPwECBAgQIECAAAECBAgQIECAAAECBAgQyJVARQYUx44di2XLlvUb1IwZM6Kjo2PEIUXyOKdPPvkkrZ28h2Lt2rWDvhBbtmyJDz/8MP39Qw89FMljnywCBAgQIECAAAECBAgQIECAAAECBAgQIFBJAhUZUDQ3N8epU6cGzbmtrS3mz59f9Pz//fffmDt3buEl2M8999xV7444efJkv/dSJI95qqmpKbqvjQQIECBAgAABAgQIECBAgAABAgQIECBAIG8CFRdQ9Pb2xuzZs686pyScSEKKYtc333wTL7744rC3J3dZJHdbWAQIECBAgAABAgQIECBAgAABAgQIECBAoFIEKi6guHjxYvq+iSSoGLiSxz4NfPTTcL4Ira2tcejQoeFsSa9NHi/1/vvvD3ufDQQIECBAgAABAgQIECBAgAABAgQIECBAIK8CFRdQJIPavHlz7Nq1a9DMOjs7o76+vqhZ/vHHH/Hwww8X9iahwz333PM/a/3888/9wow9e/bEbbfdVlRvmwgQIECAAAECBAgQIECAAAECBAgQIECAQN4EKjKg6Ovri02bNsW+ffvSOynq6uoiufuhsbGx6Pl9/PHHsWHDhnT/rbfeGl9++WWMGTPm/9ZbuHBhnD59Or1m+fLlsXTp0qL720iAAAECBAgQIECAAAECBAgQIECAAAECBPIkUJEBxeUBJUFFT09PTJw4ccQzuzJsSIKGJHC41kru2HjrrbfSy5JQIwlMxo4de61tPidAgAABAgQIECBAgAABAgQIECBAgAABArkXqOiAIqvpJXdBJAHF5ZXcTXH77bdfs/xvv/0Wjz76aOG6bdu2xcyZM6+5zwUECBAgQIAAAQIECBAgQIAAAQIECBAgQCDvAgKKDCbY0dERO3bsSCtNnjw5du/ePeSqyd0Wx48fT69//PHHY82aNUPe60ICBAgQIECAAAECBAgQIECAAAECBAgQIJBXAQHFCCeXPCaqqakpuru700qrVq2KxYsXD7lq8nLsN954o3D9kSNHYvz48UPe70ICBAgQIECAAAECBAgQIECAAAECBAgQIJBHAQHFCKd24sSJWLJkSaHK3r17o7a2dshV//zzz5g7d27h+vb29mhoaBjyfhcSIECAAAECBAgQIECAAAECBAgQIECAAIE8Cggo8jg1ZyZAgAABAgQIECBAgAABAgQIECBAgAABAjkXEFDkfICOT4AAAQIECBAgQIAAAQIECBAgQIAAAQIE8iggoMjj1JyZAAECBAgQIECAAAECBAgQIECAAAECBAjkXEBAkfMBOj4BAgQIECBAgAABAgQIECBAgAABAgQIEMijgIAij1NzZgIECBAgQIAAAQIECBAgQIAAAQIECBAgkHMBAUXOB+j4BAgQIECAAAECBAgQIECAAAECBAgQIEAgjwICijxOzZkJECBAgAABAgQIECBAgAABAgQIECBAgEDOBQQUOR+g4xMgQIAAAQIECBAgQIAAAQIECBAgQIAAgTwKCCjyODVnJkCAAAECBAgQIECAAAECBAgQIECAAAECORcQUOR8gI5PgAABAgQIECBAgAABAgQIECBAgAABAgTyKCCgyOPUnJkAAQIECBAgQIAAAQIECBAgQIAAAQIECORcQECR8wE6PgECBAgQIECAAAECBAgQIECAAAECBAgQyKOAgCKPU3NmAgQIECBAgAABAgQIECBAgAABAgQIECCQcwEBRUYD3LlzZ7S3txeq3XzzzYMqV1VVxd133x1Tp06NO+64I+69994YN25cRidQhgABAgQIECBAgAABAgQIECBAgAABAgQI5EdAQJHRrN5+++344IMPhlVt5syZsXHjxrjpppuGtc/FBAgQIECAAAECBAgQIECAAAECBAgQIEAg7wICiowmODCgqK6u7le5t7f3qp0mTZoU7777btTW1mZ0EmUIECBAgAABAgQIECBAgAABAgQIECBAgED5CwgoMprRlQHFk08+GS+99NKgyn///Xf89NNP8d5778WPP/5Y+HzBggWxdu3ajE6iDAECBAgQIECAAAECBAgQIECAAAECBAgQKH8BAUVGMxpKQHG5VV9fX7S0tPQLKY4ePZrRSZQhQIAAAQIECBAgQIAAAQIECBAgQIAAAQLlLyCgyGhGwwkokpZdXV2xcuXKQvcDBw5ETU1NRqdRhgABAgQIECBAgAABAgQIECBAgAABAgQIlLeAgCKj+Qw3oDh9+nQsXLiw0P27776LcePGZXQaZQgQIECAAAECBAgQIECAAAECBAgQIECAQHkLCCgyms9wA4r9+/dHW1tb2n3WrFmxdevWjE6iDAECBAgQIECAAAECBAgQIECAAAECBAgQKH8BAUVGMxpOQPHrr7/Gs88+G93d3Wn3devWxbx58zI6iTIECBAgQIAAAQIECBAgQIAAAQIECBAgQKD8BQQUGc3oyoBi6tSp8corr/Sr3NPTE+fPn48ffvgh9uzZU/jsqaeeihdeeCGjUyhDgAABAgQIECBAgAABAgQIECBAgAABAgTyISCgyGhOVwYUQylZV1cXK1asiAceeCBuuOGGoWxxDQECBAgQIECAAAECBAgQIECAAAECBAgQGDUCFRtQnDlzJg4fPhznzp2LadOmxZw5c6K6urrowQ43oEgaNTQ0xCOPPJL+N3bs2KJ720iAAAECBAgQIECAAAECBAgQIECAAAECBPImUJEBxbFjx2LZsmX9ZjVjxozo6OgoOqQYGFAsWrSoX/2+vr44e/ZsJMFI8u+V65lnnonVq1fn7bvjvAQIECBAgAABAgQIECBAgAABAgQIECBAoGiBigwompub49SpU4PQ2traYv78+UVhDucl2X/99Ve8/vrrcfDgwUKv5D0UyfsoLAIECBAgQIAAAQIECBAgQIAAAQIECBAgUAkCFRdQ9Pb2xuzZs6862yScSEKKYtZwAorL9V977bX4/PPP0x+nTJkSH330UTGt7SFAgAABAgQIECBAgAABAgQIECBAgAABArkTqLiA4uLFi+n7JpKgYuBKHvs08NFPQ51oMQHF999/Hy0tLYUWyR0VEyZMGGpL1xEgQIAAAQIECBAgQIAAAQIECBAgQIAAgdwKVFxAkUxq8+bNsWvXrkFD6+zsjPr6+qKGWUxA8fvvv0dTU1Oh386dO+Ouu+4qqr9NBAgQIECAAAECBAgQIECAAAECBAgQIEAgTwIVGVAkL6zetGlT7Nu3L72Toq6uLlpbW6OxsbHo2RUTUAx8WffevXujtra26DPYSIAAAQIECBAgQIAAAQIECBAgQIAAAQIE8iJQkQHF5eEkQUVPT09MnDhxxPMabkBx4cKFWL58eZw8ebLQu6urK6qqqkZ8FgUIECBAgAABAgQIECBAgAABAgQIECBAgEC5C1R0QJHlcIYaUPzzzz+R3Dmxbdu2fuFEc3NzPP/881keSS0CBAgQIECAAAECBAgQIECAAAECBAgQIFC2AgKKjEZzZUCRlEweGzVwnT9//qov5541a1Zs2LAhampqMjqNMgQIECBAgAABAgQIECBAgAABAgQIECBAoLwFBBQZzWdgQDHUsk8//XSsXr3ao52GCuY6AgQIECBAgAABAgQIECBAgAABAgQIEBgVAgKKjMa4devW9LFN11pTpkyJO++8M+rr69N/p0+ffq0tPidAgAABAgQIECBAgAABAgQIECBAgAABAqNOQEAx6kbqDyJAgAABAgQIECBAgAABAgQIECBAgAABAuUvIKAo/xk5IQECBAgQIECAAAECBAgQIECAAAECBAgQGHUCAopRN1J/EAECBAgQIECAAAECBAgQIECAAAECBAgQKH8BAUX5z8gJCRAgQIAAAQIECBAgQIAAAQIECBAgQIDAqBMQUIy6kfqDCBAgQIAAAQIECBAgQIAAAQIECBAgQIBA+QsIKMp/Rk5IgAABAgQIECBAgAABAgQIECBAgAABAgRGncB/E8anVt2hMXAAAAAASUVORK5CYII="
    />
  </Should>
  <div slot="fail" let:error={err2}>
    <pre>{err2.message}</pre>
    <Show element={err2.diff} />
  </div>
</Test>
