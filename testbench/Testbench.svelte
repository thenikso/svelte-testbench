<script>
  import {
    Suite,
    Describe,
    Test,
    Actual,
    Expect,
    Show,
    snapshotMatch,
    waitOk,
    giveOk,
    snapshot,
    log,
    snapshotOnTrigger,
    snapshotTrigger,
    action,
    dataURL,
    copy,
  } from '../src';
  import Reveal from './Reveal.svelte';

  const template = (imgs) =>
    imgs.map((src, i) => `<img alt="expected-${i}" src="${src}" />`).join('\n');
</script>

<Describe title="Examples" assert={snapshotMatch()}>
  <Test>
    <Actual given="a revealed content" prepare={[waitOk(), 'li', snapshot()]}>
      <Reveal each="li" after={1} on:reveal={giveOk()}>
        <ul>
          <li>A</li>
          <li>B</li>
          <li>C</li>
        </ul>
      </Reveal>
    </Actual>
    <Expect should="matches the snapshots" prepare="ul > li">
      <ul>
        <li>A</li>
        <li>B</li>
        <li>C</li>
      </ul>
    </Expect>
    <div slot="fail" let:error>
      {error.message}
      <Show element={error.diff} />
    </div>
  </Test>

  <Test>
    <Actual
      given="a slowly revealed content"
      prepare={[
        snapshotOnTrigger(),
        waitOk(),
        action('copy', [dataURL(), log(), copy(template)]),
      ]}
    >
      <Reveal
        each="li"
        after={1}
        on:almost={snapshotTrigger()}
        on:reveal={giveOk()}
      >
        <ul>
          <li>A</li>
          <li>B</li>
          <li>D</li>
        </ul>
      </Reveal>
    </Actual>
    <Expect should="match these images">
      <img
        alt="expected-0"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABigAAAAkCAYAAAATibJVAAAITklEQVR4Xu3dX2iO/R8H8A/lwKK20sQUsaSltByxLC3FWi0nK4qDUciBiNUO5M8BtZU/5WD5G1G0lANay4kYy5FkLUrRlNKEFcPBsqfrqt09z8/veczmXvfV/foe7b53fT+fb6/Pdfbuuq9po6Ojo2ERIECAAAECBAgQIECAAAECBAgQIECAAAECBKZQYJqAYgq1tSJAgAABAgQIECBAgAABAgQIECBAgAABAgRSAQGFG4EAAQIECBAgQIAAAQIECBAgQIAAAQIECBCYcgEBxZSTa0iAAAECBAgQIECAAAECBAgQIECAAAECBAgIKNwDBAgQIECAAAECBAgQIECAAAECBAgQIECAwJQLCCimnFxDAgQIECBAgAABAgQIECBAgAABAgQIECBAQEDhHiBAgAABAgQIECBAgAABAgQIECBAgAABAgSmXEBAkWfyvr6+WLduXQwODqadHj16FKtXr85zV+UJECBAgAABAgQIECBAgAABAgQIECBAgEBhCwgo8jyf1tbWaGtry3XZtWtXdHR05Lmr8gQIECBAgAABAgQIECBAgAABAgQIECBAoLAFBBR5nM/IyEhUVFTknp4YazU8PBwlJSV57Kw0AQIECBAgQIAAAQIECBAgQIAAAQIECBAobAEBRR7nc/fu3Vi/fv1PHTo7O6OpqSmPnZUmQIAAAQIECBAgQIAAAQIECBAgQIAAAQKFLSCgyON8tm7dGteuXUs7LF68OF69epX+3dDQEHfu3MljZ6UJECBAgAABAgQIECBAgAABAgQIECBAgEBhCwgo8jSfoaGhKCsry1V/8eJFLFu2LPf57du3MX/+/Dx1V5YAAQIECBAgQIAAAQIECBAgQIAAAQIECBS2gIAiT/O5fPlyNDc3p9WTn3nq7u6OzZs3x40bN9LvTp06FXv37s1Td2UJECBAgAABAgQIECBAgAABAgQIECBAgEBhCwgo8jSf2tra6OnpSatfvXo1tmzZErdv347Gxsb0u6qqqujv789Td2UJECBAgAABAgQIECBAgAABAgQIECBAgEBhCwgo8jCf5F0TS5YsyVX+9OlTlJaWxvfv36O8vDw+f/6c/u/JkydRXV2dhxMoSYAAAQIECBAgQIAAAQIECBAgQIAAAQIECltAQJGH+Rw7diwOHjyYVm5qaorOzs5cl507d8a5c+fSzy0tLdHe3p6HEyhJgAABAgQIECBAgAABAgQIECBAgAABAgQKW0BA8YfnMzo6GpWVlZE8RZGsW7duxcaNG3Nd7t27F3V1denn2bNnx4cPH2LGjBl/+BTKESBAgAABAgQIECBAgAABAgQIECBAgACBwhYo2oDi+fPn6TshBgYGYtWqVWmIMGvWrElPq7e3N2pqanJ1vn79GjNnzsx9HhkZiYqKihgcHEy/6+rqivr6+kn3VYAAAQIECBAgQIAAAQIECBAgQIAAAQIECGRJoCgDivv378fatWv/MackVOju7p50SLF79+7o6OhIa2/fvj0uXLjw0/1w4MCBOHHiRPr9pk2b4vr161m6Z5yVAAECBAgQIECAAAECBAgQIECAAAECBAhMWqAoA4qVK1emL6j+33Xp0qVobm6eMOq3b99i7ty5uZdgHz9+PDZs2PBTvcePH0cSZIytjx8/RllZ2YT72kiAAAECBAgQIECAAAECBAgQIECAAAECBLImUHQBxZcvX9J3P/y/tW3btrh48eKEZ3jz5s30pdi/u5KnLJKnLSwCBAgQIECAAAECBAgQIECAAAECBAgQIFAsAkUXUPz48SNKS0tzTzn8fdBHjhyJw4cPT3j2jY2N6XstfnclPy/18OHD393megIECBAgQIAAAQIECBAgQIAAAQIECBAgkFmBogsokknt27cvTp8+/dPQkp99qq6untAw3717F/PmzcvtTUKHurq6f6319OnTf4QZL1++jMrKygn1tokAAQIECBAgQIAAAQIECBAgQIAAAQIECGRNoCgDipGRkTSkuHLlSvokxdKlS+PkyZPR0NAw4fmdOXMm9uzZk+5fsGBBvHnzJqZNm/af9VasWBHPnj1Lrzl69GgcOnRowv1tJECAAAECBAgQIECAAAECBAgQIECAAAECWRIoyoBibEBJUDE0NBRz5syZ9Mz+HjYkQUMSOPxqJaHI/v3708uSUGNgYCCmT5/+q23+T4AAAQIECBAgQIAAAQIECBAgQIAAAQIEMi9Q1AHFn5pe8hREElCMrb6+vli+fPkvyydPWSxcuDB33YMHD2LNmjW/3OcCAgQIECBAgAABAgQIECBAgAABAgQIECCQdQEBxR+YYGtra7S1taWVqqqqor+/f9xVa2tro6enJ71+x44dcfbs2XHvdSEBAgQIECBAgAABAgQIECBAgAABAgQIEMiqgIBikpNLfiaqoqIiBgcH00rt7e3R0tIy7qrnz59Pg4mxNTw8HCUlJePe70ICBAgQIECAAAECBAgQIECAAAECBAgQIJBFAQHFJKfW29sbNTU1uSqvX7+ORYsWjbvq+/fvo7y8PHd9V1dX1NfXj3u/CwkQIECAAAECBAgQIECAAAECBAgQIECAQBYFBBRZnJozEyBAgAABAgQIECBAgAABAgQIECBAgACBjAsIKDI+QMcnQIAAAQIECBAgQIAAAQIECBAgQIAAAQJZFBBQZHFqzkyAAAECBAgQIECAAAECBAgQIECAAAECBDIuIKDI+AAdnwABAgQIECBAgAABAgQIECBAgAABAgQIZFFAQJHFqTkzAQIECBAgQIAAAQIECBAgQIAAAQIECBDIuICAIuMDdHwCBAgQIECAAAECBAgQIECAAAECBAgQIJBFgb8AI5fKpAR9yooAAAAASUVORK5CYII="
      />
      <img
        alt="expected-1"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABigAAABICAYAAABsv310AAAP7klEQVR4Xu3dfWiV9fsH8EvJJHGwlSxqQWYyQsKnJaRDG5LYGIgQQoX+Me35icwkiWgqVDiaCUZSPpQoFFL4hyFDKpuWSH9YKWIQKAvKWOgWU7MY7su5wcN0/X5uZ+fIuXdeN0Ru5/5c17XXdf57c849ore3tzdcBAgQIECAAAECBAgQIECAAAECBAgQIECAAIHrKDBCQHEdtbUiQIAAAQIECBAgQIAAAQIECBAgQIAAAQIEEgEBhTcCAQIECBAgQIAAAQIECBAgQIAAAQIECBAgcN0FBBTXnVxDAgQIECBAgAABAgQIECBAgAABAgQIECBAQEDhPUCAAAECBAgQIECAAAECBAgQIECAAAECBAhcdwEBxXUn15AAAQIECBAgQIAAAQIECBAgQIAAAQIECBAQUHgPECBAgAABAgQIECBAgAABAgQIECBAgAABAtddQEBRYPJjx47Fgw8+GB0dHUmn7777LmbNmlXgrsoTIECAAAECBAgQIECAAAECBAgQIECAAIHiFhBQFHg/q1atinXr1mW7PP3007Fp06YCd1WeAAECBAgQIECAAAECBAgQIECAAAECBAgUt4CAooD76enpiaqqquynJy63On/+fIwZM6aAnZUmQIAAAQIECBAgQIAAAQIECBAgQIAAAQLFLSCgKOB+9u3bF/Pnz+/XYdeuXbFo0aICdlaaAAECBAgQIECAAAECBAgQIECAAAECBAgUt4CAooD7WbJkSezcuTPpMGHChDh58mTy74aGhvjiiy8K2FlpAgQIECBAgAABAgQIECBAgAABAgQIECBQ3AICigLtp6urKyoqKrLVf/7557jnnnuyP//2229x++23F6i7sgQIECBAgAABAgQIECBAgAABAgQIECBAoLgFBBQF2s/HH38cjY2NSfXM1zy1trbGo48+Gp9++mnyu3fffTdeeumlAnVXlgABAgQIECBAgAABAgQIECBAgAABAgQIFLeAgKJA+5kzZ04cPHgwqb5jx45YvHhx7NmzJxYsWJD8btKkSXH8+PECdVeWAAECBAgQIECAAAECBAgQIECAAAECBAgUt4CAogD7yTxr4u67785W7uzsjPLy8rh48WJUVlZGd3d38tqRI0di2rRpBZhASQIECBAgQIAAAQIECBAgQIAAAQIECBAgUNwCAooC7OfNN9+M119/Pam8aNGi2LVrV7bLU089FR9++GHy88qVK6O5ubkAEyhJgAABAgQIECBAgAABAgQIECBAgAABAgSKW0BAkef99Pb2xsSJEyPzKYrMtXv37li4cGG2y/79+2Pu3LnJz2VlZXHmzJkYNWpUnqdQjgABAgQIECBAgAABAgQIECBAgAABAgQIFLdAyQYUJ06cSJ4J0d7eHjNnzkxChLFjxw55W4cOHYra2tpsnQsXLsRNN92U/bmnpyeqqqqio6Mj+d3evXujvr5+yH0VIECAAAECBAgQIECAAAECBAgQIECAAAECaRIoyYCira0t6urqrthTJlRobW0dckjx7LPPxqZNm5Lay5Ytiy1btvR7P7zyyivR0tKS/P6RRx6JTz75JE3vGbMSIECAAAECBAgQIECAAAECBAgQIECAAIEhC5RkQFFTU5M8oPrqa9u2bdHY2Jgz6t9//x233npr9iHYb731Vjz00EP96h0+fDgyQcbl6+zZs1FRUZFzXwcJECBAgAABAgQIECBAgAABAgQIECBAgEDaBEouoDh37lzy7If/upYuXRpbt27NeYefffZZ8lDswV6ZT1lkPm3hIkCAAAECBAgQIECAAAECBAgQIECAAAECpSJQcgHFpUuXory8PPsph76LXr16dTQ1NeW8+wULFiTPtRjslfl6qW+//Xawx9xPgAABAgQIECBAgAABAgQIECBAgAABAgRSK1ByAUVmU8uXL48NGzb0W1rma5+mTZuW0zL/+OOPuO2227JnM6HD3Llz/89aP/744xVhxi+//BITJ07MqbdDBAgQIECAAAECBAgQIECAAAECBAgQIEAgbQIlGVD09PQkIcX27duTT1JUV1fH+vXro6GhIef9bdy4MV588cXk/B133BG//vprjBgx4v+tN2XKlDh69Ghyz5o1a+KNN97Iub+DBAgQIECAAAECBAgQIECAAAECBAgQIEAgTQIlGVBcXlAmqOjq6opx48YNeWd9w4ZM0JAJHK51ZUKRFStWJLdlQo329vYYOXLktY55nQABAgQIECBAgAABAgQIECBAgAABAgQIpF6gpAOKfG0v8ymITEBx+Tp27Fjce++91yyf+ZTFnXfemb3vwIEDMXv27GuecwMBAgQIECBAgAABAgQIECBAgAABAgQIEEi7gIAiDxtctWpVrFu3Lqk0adKkOH78+ICrzpkzJw4ePJjc/+STT8YHH3ww4LNuJECAAAECBAgQIECAAAECBAgQIECAAAECaRUQUAxxc5mviaqqqoqOjo6kUnNzc6xcuXLAVTdv3pwEE5ev8+fPx5gxYwZ83o0ECBAgQIAAAQIECBAgQIAAAQIECBAgQCCNAgKKIW7t0KFDUVtbm61y6tSpGD9+/ICr/vnnn1FZWZm9f+/evVFfXz/g824kQIAAAQIECBAgQIAAAQIECBAgQIAAAQJpFBBQpHFrZiZAgAABAgQIECBAgAABAgQIECBAgAABAikXEFCkfIHGJ0CAAAECBAgQIECAAAECBAgQIECAAAECaRQQUKRxa2YmQIAAAQIECBAgQIAAAQIECBAgQIAAAQIpFxBQpHyBxidAgAABAgQIECBAgAABAgQIECBAgAABAmkUEFCkcWtmJkCAAAECBAgQIECAAAECBAgQIECAAAECKRcQUKR8gcYnQIAAAQIECBAgQIAAAQIECBAgQIAAAQJpFBBQpHFrZiZAgAABAgQIECBAgAABAgQIECBAgAABAikXEFCkfIHGJ0CAAAECBAgQIECAAAECBAgQIECAAAECaRQQUKRxa2YmQIAAAQIECBAgQIAAAQIECBAgQIAAAQIpFxBQpHyBxidAgAABAgQIECBAgAABAgQIECBAgAABAmkUEFCkcWtmJkCAAAECBAgQIECAAAECBAgQIECAAAECKRcQUKR8gcYnQIAAAQIECBAgQIAAAQIECBAgQIAAAQJpFBBQpHFrZiZAgAABAgQIECBAgAABAgQIECBAgAABAikXEFDkaYHNzc3x6quvZqtVVlb2q3zjjTfGjBkzYvr06TF16tSYN29ejB49Ok8TKEOAAAECBAgQIECAAAECBAgQIECAAAECBNIjIKDI065ee+21ePvttwdVbfbs2bF79+645ZZbBnXOzQQIECBAgAABAgQIECBAgAABAgQIECBAIO0CAoo8bfDqgKKsrOyKyt3d3f/ZacKECfHVV1/F+PHj8zSJMgQIECBAgAABAgQIECBAgAABAgQIECBAoPgFBBR52lHfgOKZZ56J999/v1/lv/76K3744YdYs2ZNfPPNN9nXly1bFlu2bMnTJMoQIECAAAECBAgQIECAAAECBAgQIECAAIHiFxBQ5GlHAwkoLrfq6elJnj/RN6To7e3N0yTKECBAgAABAgQIECBAgAABAgQIECBAgACB4hcQUORpR4MJKDIt9+3bF/Pnz892P3v2bFRUVORpGmUIECBAgAABAgQIECBAgAABAgQIECBAgEBxCwgo8rSfwQYUR48ejSlTpmS7X7x4MUaPHp2naZQhQIAAAQIECBAgQIAAAQIECBAgQIAAAQLFLSCgyNN+BhtQ7Ny5M5YsWZJ0r6uri/379+dpEmUIECBAgAABAgQIECBAgAABAgQIECBAgEDxCwgo8rSjwQQUp06divvvvz86OjqS7jt27IjFixfnaRJlCBAgQIAAAQIECBAgQIAAAQIECBAgQIBA8QsIKPK0o74BxfTp0+Ojjz66onJnZ2ecPn06vv7669i8eXP2teeffz42btyYpymUIUCAAAECBAgQIECAAAECBAgQIECAAAEC6RAQUORpT30DioGUrK6ujrVr18bDDz8cN9xww0COuIcAAQIECBAgQIAAAQIECBAgQIAAAQIECAwbgZINKE6cOBF79uyJ9vb2mDlzZixcuDDGjh2b82IHG1BkGtXX18djjz2W/Ddy5MiceztIgAABAgQIECBAgAABAgQIECBAgAABAgTSJlCSAUVbW1vyYOq+V21tbbS2tuYcUlwdUCxfvvyK+j09PXHy5MnIBCOZ//e9Xn755WhpaUnbe8e8BAgQIECAAAECBAgQIECAAAECBAgQIEAgZ4GSDChqamriyJEj/dC2bdsWjY2NOWEO5iHZZ86ciSeeeCJ2796d7fXee+/Fc889l1NvhwgQIECAAAECBAgQIECAAAECBAgQIECAQNoESi6gOHfuXJSVlf3nnpYuXRpbt27NaYeDCSguN3j88cez/SZPnhw//fRTTr0dIkCAAAECBAgQIECAAAECBAgQIECAAAECaRMouYDi0qVLUV5eHt3d3f12tXr16mhqaspph7kEFF9++WXMmzcv26+zszOZzUWAAAECBAgQIECAAAECBAgQIECAAAECBIa7QMkFFJmFZp4PsWHDhn67zXzt07Rp03LaeS4Bxe+//x5VVVXZft9//33MmDEjp/4OESBAgAABAgQIECBAgAABAgQIECBAgACBNAmUZECReWB1JqTYvn178kmK6urqWL9+fTQ0NOS8u1wCigMHDsQDDzyQ7Zl5ePZdd92V8wwOEiBAgAABAgQIECBAgAABAgQIECBAgACBtAiUZEBxeTmZoKKrqyvGjRs35H0NNqD4559/oq6uLg4fPpzt/e+//8aoUaOGPIsCBAgQIECAAAECBAgQIECAAAECBAgQIECg2AVKOqDI53IGGlBcuHAh2traYu3atVeEEytWrIh33nknnyOpRYAAAQIECBAgQIAAAQIECBAgQIAAAQIEilZAQJGn1fQNKDIlM18bdfV1+vTp/3w4d+aTFJ9//nncfPPNeZpGGQIECBAgQIAAAQIECBAgQIAAAQIECBAgUNwCAoo87efqgGKgZV944YVoaWnx1U4DBXMfAQIECBAgQIAAAQIECBAgQIAAAQIECAwLAQFFntbY1NSUfG3Tta7JkyfHfffdF1OnTo2ampqYNWvWtY54nQABAgQIECBAgAABAgQIECBAgAABAgQIDDsBAcWwW6k/iAABAgQIECBAgAABAgQIECBAgAABAgQIFL+AgKL4d2RCAgQIECBAgAABAgQIECBAgAABAgQIECAw7AQEFMNupf4gAgQIECBAgAABAgQIECBAgAABAgQIECBQ/AICiuLfkQkJECBAgAABAgQIECBAgAABAgQIECBAgMCwExBQDLuV+oMIECBAgAABAgQIECBAgAABAgQIECBAgEDxCwgoin9HJiRAgAABAgQIECBAgAABAgQIECBAgAABAsNO4H/lj6dW/1g0uwAAAABJRU5ErkJggg=="
      />
    </Expect>
    <div slot="fail" let:error>
      <pre>{error.message}</pre>
      {#each error.errors as e}
        <pre>{e.message}</pre>
        <Show element={e.diff} />
      {/each}
    </div>
  </Test>
</Describe>
